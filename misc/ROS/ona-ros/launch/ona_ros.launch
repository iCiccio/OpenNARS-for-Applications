<!-- -*- xml -*-

     This tutorial relies on a live video sequence acquired with an 
     usb camera in front of a QR code planar target. The model 
     corresponding to this target is given into the models directory 
     of this package.

     Camera parameters are set as rosparam parameters. They need to be changed
     to be the one of your camera.

     See http://www.ros.org/wiki/visp_auto_tracker for more information.

  -->
  <launch>	

    <!-- Use YOLOv3 -->
    <!-- Console launch prefix -->
    <arg name="launch_prefix" default=""/>

    <!-- Config and weights folder. -->
    <arg name="yolo_weights_path"          default="$(find darknet_ros)/yolo_network_config/weights"/>
    <arg name="yolo_config_path"           default="$(find darknet_ros)/yolo_network_config/cfg"/>

    <!-- ROS and network parameter files -->
    <arg name="ros_param_file"             default="$(find darknet_ros)/config/ros.yaml"/>
    <arg name="network_param_file"         default="$(find darknet_ros)/config/yolov3.yaml"/>

    <!-- Load parameters -->
    <rosparam command="load" ns="darknet_ros" file="$(arg ros_param_file)"/>
    <rosparam command="load" ns="darknet_ros" file="$(arg network_param_file)"/>

    <node pkg="ona-ros" type="ona-ros" name="ona-ros_node" output="screen">
    </node>


    <!-- Launch the tracking node -->
    <node pkg="visp_auto_tracker" type="visp_auto_tracker" name="visp_auto_tracker" output="screen">
      <param name="model_path" value="$(find visp_auto_tracker)/models" />
      <param name="model_name" value="pattern" />
      <param name="debug_display" value="True" />
            
      <remap from="/visp_auto_tracker/camera_info" to="/usb_cam/camera_info"/>
      <remap from="/visp_auto_tracker/image_raw" to="/usb_cam/image_raw"/>
    </node>
  
    <!-- Launch the usb camera acquisition node -->
    <node pkg="usb_cam" type="usb_cam_node" name="usb_cam" output="screen">      
      <param name="image_width" value="640" />
      <param name="image_height" value="480" />
      <param name="video_device" value="/dev/video0" />      
      <param name="pixel_format" value="yuyv" />
      <!-- rename the camera name topic into /camera/image_raw to match the one in visp_auto_tracker/models/calibration.ini file --> 
      <param name="camera_name" value="/camera/image_raw" />
      <param name="camera_info_url" value="package://visp_auto_tracker/models/calibration.ini" type="string" />
    </node>

    <!-- Start darknet and ros wrapper -->
    <node pkg="darknet_ros" type="darknet_ros" name="darknet_ros" output="screen" launch-prefix="$(arg launch_prefix)">
        <param name="weights_path"          value="$(arg yolo_weights_path)" />
        <param name="config_path"           value="$(arg yolo_config_path)" />
    </node>
  
  </launch>